(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[803],{95937:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/register2",function(){return r(73616)}])},73616:function(e,t,r){"use strict";r.r(t);var n=r(85893),s=r(67294),i=r(60990),l=r(96788),a=r(11032),o=r(93454),c=r(26541),d=r(84677),u=r(52857),x=r(97182),h=r(84925),p=r(10018),g=r(87536),j=r(87066),f=r(11163),m=r(17859),v=r.n(m),Z=r(90341),b=r(62190),y=r(4307),w=r(61258);t.default=()=>{let[e,t]=(0,s.useState)(1),[r,m]=(0,s.useState)(!1),[C,I]=(0,s.useState)(""),[S,k]=(0,s.useState)("success"),[_,z]=(0,s.useState)(!1),[R,W]=(0,s.useState)(null),[E,N]=(0,s.useState)(!1),[Q,T]=(0,s.useState)([]),[V,D]=(0,s.useState)([]),O=(0,s.useRef)(null),P=(0,f.useRouter)(),{control:A,handleSubmit:F,watch:H}=(0,g.cI)(),X=H("nationalCode");(0,s.useEffect)(()=>{let e=async()=>{try{let e=await fetch("/api/grades"),t=await e.json();D(t)}catch(e){console.error("خطا در دریافت پایه‌ها:",e)}};(async()=>{try{let e=await fetch("/api/majors"),t=await e.json();T(t)}catch(e){console.error("خطا در دریافت رشته‌ها:",e)}})(),e()},[]);let Y=()=>{N(!0)},q=async e=>{try{z(!0);let t=await fetch("http://localhost:5000/upload",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({image:e,nationalCode:X})}),r=await t.json();t.ok&&"success"===r.status?(I(r.message||"تصویر با موفقیت تأیید شد!"),k("success")):(I(r.message||"خطا در تأیید تصویر."),k("error"),W(null))}catch(e){console.error("Error sending image:",e),I("خطا در ارتباط با سرور."),k("error"),W(null)}finally{z(!1),m(!0)}},J=async e=>{if(!R){I("لطفاً ابتدا تصویر شناسایی خود را بگیرید و آپلود کنید."),k("error"),m(!0);return}let t={...e,roleId:1,identityPhoto:R};try{z(!0);let e=await j.Z.post("http://localhost:3001/users/add-user",t);if(e.status>=200&&e.status<300)console.log("Registration successful:",e.data),I("ثبت‌نام با موفقیت انجام شد!"),k("success"),m(!0),setTimeout(()=>{try{P.push("/login")}catch(e){console.error("Error navigating to login page:",e),window.location.href="/login"}},2e3);else{console.error("Server responded with non-success status:",e.status,e.data);let t=e.data;I(t.message||"عملیات ثبت‌نام با خطا مواجه شد."),k("error"),m(!0)}}catch(e){var r,n;console.error("Registration error:",e),I((null===(n=e.response)||void 0===n?void 0:null===(r=n.data)||void 0===r?void 0:r.message)||e.message||"خطا در ارسال داده‌ها"),k("error"),m(!0)}finally{z(!1)}};return(0,n.jsxs)(a.Z,{component:"main",maxWidth:"xs",children:[(0,n.jsx)(i.Z,{sx:{marginTop:8,display:"flex",flexDirection:"column",alignItems:"center",minHeight:"100vh",padding:4},children:(0,n.jsxs)(o.Z,{elevation:6,sx:{p:4,width:"100%",maxWidth:400,borderRadius:3,position:"relative",overflow:"hidden"},children:[(0,n.jsx)(l.Z,{component:"h1",variant:"h4",sx:{mb:4,textAlign:"center",fontWeight:"bold",color:"primary.main"},children:"ثبت‌نام"}),(0,n.jsxs)(i.Z,{sx:{mb:4},children:[(0,n.jsxs)(i.Z,{sx:{display:"flex",justifyContent:"space-between",position:"relative",mb:2},children:[[1,2].map(t=>(0,n.jsx)(i.Z,{sx:{width:40,height:40,borderRadius:"50%",bgcolor:t<=e?"primary.main":"grey.300",display:"flex",alignItems:"center",justifyContent:"center",color:t<=e?"white":"text.secondary",zIndex:1,transition:"all 0.3s ease"},children:t},t)),(0,n.jsx)(i.Z,{sx:{position:"absolute",top:"50%",left:0,right:0,height:2,bgcolor:"grey.300",transform:"translateY(-50%)",zIndex:0}}),(0,n.jsx)(i.Z,{sx:{position:"absolute",top:"50%",left:0,height:2,bgcolor:"primary.main",transform:"translateY(-50%)",zIndex:0,width:"".concat((e-1)*100,"%"),transition:"width 0.3s ease"}})]}),(0,n.jsx)(l.Z,{variant:"body1",sx:{textAlign:"center",color:"text.secondary",mt:1},children:1===e?"تایید هویت":"اطلاعات شخصی"})]}),1===e&&(0,n.jsxs)(i.Z,{sx:{display:"flex",flexDirection:"column",gap:3},children:[(0,n.jsx)(g.Qr,{name:"nationalCode",control:A,defaultValue:"",render:e=>{let{field:t}=e;return(0,n.jsx)(c.Z,{...t,fullWidth:!0,label:"کد ملی",required:!0,variant:"outlined",sx:{direction:"rtl"}})}}),(0,n.jsx)(l.Z,{variant:"body1",sx:{textAlign:"center",mb:2},children:"لطفاً تصویر شناسایی خود را بگیرید و آپلود کنید"}),E?(0,n.jsxs)(i.Z,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,n.jsx)(v(),{audio:!1,ref:O,screenshotFormat:"image/jpeg",videoConstraints:{width:400,height:300,facingMode:"user"},style:{width:"100%",borderRadius:8}}),(0,n.jsx)(d.Z,{variant:"contained",onClick:()=>{if(!X){I("لطفاً ابتدا کد ملی خود را وارد کنید."),k("error"),m(!0);return}if(O.current){let e=O.current.getScreenshot();e?(W(e),N(!1),q(e)):(I("امکان گرفتن عکس وجود ندارد."),k("error"),m(!0))}},sx:{width:"100%"},startIcon:(0,n.jsx)(Z.Z,{}),children:"عکس بگیر"})]}):(0,n.jsx)(n.Fragment,{children:R?(0,n.jsxs)(i.Z,{sx:{position:"relative",width:"100%",aspectRatio:"3/4",mb:2},children:[(0,n.jsx)("img",{src:R,alt:"تصویر شناسایی",style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:8}}),(0,n.jsx)(u.Z,{onClick:()=>W(null),sx:{position:"absolute",top:8,right:8,bgcolor:"rgba(0,0,0,0.5)",color:"white","&:hover":{bgcolor:"rgba(0,0,0,0.7)"}},children:(0,n.jsx)(b.Z,{size:16})}),(0,n.jsx)(d.Z,{variant:"outlined",onClick:Y,startIcon:(0,n.jsx)(Z.Z,{}),sx:{width:"100%",mt:2},children:"باز کردن دوربین مجدد"})]}):(0,n.jsx)(d.Z,{variant:"outlined",onClick:Y,startIcon:(0,n.jsx)(Z.Z,{}),sx:{py:5,borderStyle:"dashed"},children:"باز کردن دوربین"})})]}),2===e&&(0,n.jsxs)(i.Z,{sx:{display:"flex",flexDirection:"column",gap:3},children:[(0,n.jsx)(g.Qr,{name:"fullName",control:A,defaultValue:"",render:e=>{let{field:t}=e;return(0,n.jsx)(c.Z,{...t,fullWidth:!0,label:"نام و نام خانوادگی",variant:"outlined",sx:{direction:"rtl"}})}}),(0,n.jsx)(g.Qr,{name:"phoneNumber",control:A,defaultValue:"",render:e=>{let{field:t}=e;return(0,n.jsx)(c.Z,{...t,fullWidth:!0,label:"شماره تماس",variant:"outlined",sx:{direction:"rtl"}})}}),(0,n.jsx)(g.Qr,{name:"password",control:A,defaultValue:"",render:e=>{let{field:t}=e;return(0,n.jsx)(c.Z,{...t,fullWidth:!0,label:"رمز عبور",type:"password",variant:"outlined",sx:{direction:"rtl"}})}}),(0,n.jsx)(g.Qr,{name:"majorId",control:A,defaultValue:0,render:e=>{let{field:t}=e;return(0,n.jsxs)(c.Z,{...t,select:!0,fullWidth:!0,label:"انتخاب رشته",SelectProps:{native:!0},variant:"outlined",sx:{direction:"rtl"},onChange:e=>t.onChange(parseInt(e.target.value,10)),value:t.value,children:[(0,n.jsx)("option",{value:0,children:"انتخاب رشته"}),Q.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))]})}}),(0,n.jsx)(g.Qr,{name:"gradeId",control:A,defaultValue:0,render:e=>{let{field:t}=e;return(0,n.jsxs)(c.Z,{...t,select:!0,fullWidth:!0,label:"انتخاب پایه",SelectProps:{native:!0},variant:"outlined",sx:{direction:"rtl"},onChange:e=>t.onChange(parseInt(e.target.value,10)),value:t.value,children:[(0,n.jsx)("option",{value:0,children:"انتخاب پایه"}),V.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))]})}})]}),(0,n.jsxs)(i.Z,{sx:{display:"flex",gap:2,mt:4},children:[e>1&&(0,n.jsx)(d.Z,{variant:"outlined",onClick:()=>{e>1&&t(e-1)},startIcon:(0,n.jsx)(y.Z,{}),sx:{flex:1},children:"مرحله قبل"}),e<2?(0,n.jsx)(d.Z,{variant:"contained",onClick:()=>{if(1===e&&!R){I("لطفاً ابتدا تصویر شناسایی خود را بگیرید و آپلود کنید."),k("error"),m(!0);return}e<2&&t(e+1)},endIcon:(0,n.jsx)(w.Z,{}),sx:{flex:1},children:"مرحله بعد"}):(0,n.jsx)(d.Z,{variant:"contained",onClick:F(J),disabled:_,sx:{flex:1},children:_?(0,n.jsx)(x.Z,{size:24,color:"inherit"}):"ثبت‌نام"})]})]})}),(0,n.jsx)(h.Z,{open:r,autoHideDuration:6e3,onClose:()=>m(!1),anchorOrigin:{vertical:"bottom",horizontal:"left"},children:(0,n.jsx)(p.Z,{severity:S,action:(0,n.jsx)(u.Z,{size:"small",color:"inherit",onClick:()=>m(!1),children:(0,n.jsx)(b.Z,{size:16})}),children:C})}),_&&(0,n.jsx)(i.Z,{sx:{position:"fixed",top:0,left:0,right:0,bottom:0,bgcolor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999},children:(0,n.jsxs)(o.Z,{sx:{p:3,display:"flex",alignItems:"center",gap:2,borderRadius:2},children:[(0,n.jsx)(x.Z,{size:24}),(0,n.jsx)(l.Z,{children:"در حال پردازش..."})]})})]})}}},function(e){e.O(0,[6838,9311,1349,7536,4109,2888,9774,179],function(){return e(e.s=95937)}),_N_E=e.O()}]);