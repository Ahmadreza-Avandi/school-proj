(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7979],{88930:function(e,l,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/viewusers",function(){return a(18704)}])},18704:function(e,l,a){"use strict";a.r(l);var s=a(85893),r=a(67294),n=a(18745),i=a(61730),o=a(96788),t=a(81873),d=a(60990),c=a(97182),u=a(10018),x=a(6897),h=a(45083),m=a(15972),j=a(26541),Z=a(95611),p=a(60762),v=a(71919),g=a(84677),f=a(25026),b=a(93454),y=a(76592),C=a(70360),N=a(46577),z=a(8863),w=a(19827),I=a(84925),k=a(36127),S=a(69819),W=a(62190),_=a(31855),E=a(37864),R=a(87066);l.default=()=>{let e=(0,n.Z)(),l=(0,i.Z)(e.breakpoints.down("md")),[a,F]=(0,r.useState)([]),[O,T]=(0,r.useState)([]),[D,L]=(0,r.useState)([]),[P,A]=(0,r.useState)(""),[H,B]=(0,r.useState)(""),[M,X]=(0,r.useState)({}),[J,Y]=(0,r.useState)({}),[q,G]=(0,r.useState)(!0),[K,Q]=(0,r.useState)(null),[U,V]=(0,r.useState)(""),[$,ee]=(0,r.useState)({open:!1,message:"",severity:"success"}),el=(e,l)=>{ee({open:!0,message:e,severity:l})},ea=async()=>{G(!0);try{let[e,l,a]=await Promise.all([R.Z.get("/api/classes"),R.Z.get("/api/roles"),R.Z.get("/api/user.view",{params:{classId:P||void 0,roleId:H||void 0}})]);L(e.data),T(l.data),F(a.data),Q(null)}catch(e){console.error("Error fetching data:",e),Q("خطا در دریافت اطلاعات از سرور"),el("خطا در دریافت اطلاعات از سرور","error")}finally{G(!1)}};(0,r.useEffect)(()=>{ea()},[P,H]);let es=(0,r.useMemo)(()=>a.filter(e=>e.fullName.toLowerCase().includes(U.toLowerCase())||e.role.name.toLowerCase().includes(U.toLowerCase())||e.nationalCode.includes(U)),[a,U]),er=e=>{X(l=>({...l,[e]:!l[e]})),M[e]&&Y({})},en=(e,l)=>{Y(a=>({...a,[e]:l}))},ei=async e=>{try{await R.Z.put("/api/users/".concat(e),{...J,classId:J.classId||null}),er(e),Y({}),ea(),el("اطلاعات کاربر با موفقیت به‌روزرسانی شد","success")}catch(e){console.error("Error updating user:",e),el("خطا در به‌روزرسانی اطلاعات کاربر","error")}},eo=async e=>{try{await R.Z.delete("/api/users/".concat(e)),F(l=>l.filter(l=>l.id!==e)),el("کاربر با موفقیت حذف شد","success")}catch(e){console.error("Error deleting user:",e),el("خطا در حذف کاربر","error")}},et=e=>{let l;if("string"==typeof e)try{l=JSON.parse(e)}catch(e){return(0,s.jsx)(o.Z,{color:"error",children:"خطا در نمایش مجوزها"})}else l=e;return Array.isArray(l)?l.map(e=>(0,s.jsx)(t.Z,{label:e.name,size:"small",color:"primary",sx:{m:.5}},e.id)):"object"==typeof l&&null!==l?Object.entries(l).map(e=>{let[l,a]=e;return(0,s.jsx)(t.Z,{label:"".concat(l,": ").concat(a?"دارد":"ندارد"),size:"small",color:a?"primary":"default",sx:{m:.5}},l)}):(0,s.jsx)(o.Z,{color:"text.secondary",children:"بدون مجوز"})};if(q)return(0,s.jsx)(d.Z,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"50vh",children:(0,s.jsx)(c.Z,{})});if(K)return(0,s.jsx)(u.Z,{severity:"error",sx:{m:2},children:K});let ed=()=>(0,s.jsx)(x.Z,{sx:{minWidth:200},children:(0,s.jsxs)(h.Z,{value:P,onChange:e=>A(""===e.target.value?"":Number(e.target.value)),displayEmpty:!0,size:"small",sx:{borderRadius:2},children:[(0,s.jsx)(m.Z,{value:"",children:"همه کلاس‌ها"}),D.map(e=>(0,s.jsxs)(m.Z,{value:e.id,children:[e.name," (",e.grade," - ",e.major,")"]},e.id))]})}),ec=()=>(0,s.jsx)(x.Z,{sx:{minWidth:200},children:(0,s.jsxs)(h.Z,{value:H,onChange:e=>B(""===e.target.value?"":Number(e.target.value)),displayEmpty:!0,size:"small",sx:{borderRadius:2},children:[(0,s.jsx)(m.Z,{value:"",children:"همه نقش‌ها"}),O.map(e=>(0,s.jsx)(m.Z,{value:e.id,children:e.name},e.id))]})}),eu={borderRadius:1.5,textTransform:"none",boxShadow:"none","&:hover":{boxShadow:"none"}};return(0,s.jsxs)(d.Z,{sx:{height:"100%",display:"flex",flexDirection:"column",p:2},children:[(0,s.jsx)(()=>(0,s.jsxs)(d.Z,{sx:{mb:3,px:2,display:"flex",gap:2,flexDirection:{xs:"column",sm:"row"}},children:[(0,s.jsx)(ed,{}),(0,s.jsx)(ec,{}),(0,s.jsx)(j.Z,{fullWidth:!0,placeholder:"جستجو بر اساس نام، نقش یا کد ملی...",value:U,onChange:e=>V(e.target.value),InputProps:{startAdornment:(0,s.jsx)(Z.Z,{position:"start",children:(0,s.jsx)(k.Z,{size:20})})},sx:{"& .MuiOutlinedInput-root":{borderRadius:2,backgroundColor:"background.paper"}}})]}),{}),l?(0,s.jsx)(()=>(0,s.jsx)(d.Z,{sx:{p:2,height:"calc(100vh - 180px)",overflowY:"auto"},children:es.length>0?es.map(e=>{var l,a,r,n,i,t;return(0,s.jsx)(p.Z,{sx:{mb:2,borderRadius:2,boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:(0,s.jsxs)(v.Z,{children:[(0,s.jsxs)(d.Z,{sx:{mb:2},children:[(0,s.jsx)(o.Z,{variant:"h6",gutterBottom:!0,children:M[e.id]?(0,s.jsx)(j.Z,{fullWidth:!0,value:null!==(l=J.fullName)&&void 0!==l?l:e.fullName,onChange:e=>en("fullName",e.target.value),size:"small"}):e.fullName}),(0,s.jsx)(d.Z,{sx:{display:"flex",flexDirection:"column",gap:1.5},children:M[e.id]?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(j.Z,{label:"کد ملی",fullWidth:!0,value:null!==(a=J.nationalCode)&&void 0!==a?a:e.nationalCode,onChange:e=>en("nationalCode",e.target.value),size:"small"}),(0,s.jsx)(j.Z,{label:"شماره تلفن",fullWidth:!0,value:null!==(r=J.phoneNumber)&&void 0!==r?r:e.phoneNumber,onChange:e=>en("phoneNumber",e.target.value),size:"small"}),(0,s.jsx)(h.Z,{fullWidth:!0,value:null!==(n=J.roleId)&&void 0!==n?n:e.roleId,onChange:e=>en("roleId",Number(e.target.value)),size:"small",children:O.map(e=>(0,s.jsx)(m.Z,{value:e.id,children:e.name},e.id))}),(0,s.jsxs)(h.Z,{fullWidth:!0,value:null!==(t=null!==(i=J.classId)&&void 0!==i?i:e.classId)&&void 0!==t?t:"",onChange:e=>en("classId",""===e.target.value?"":Number(e.target.value)),size:"small",children:[(0,s.jsx)(m.Z,{value:"",children:"بدون کلاس"}),D.map(e=>(0,s.jsxs)(m.Z,{value:e.id,children:[e.name," (",e.grade," - ",e.major,")"]},e.id))]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(o.Z,{variant:"body2",color:"text.secondary",children:["کد ملی: ",e.nationalCode]}),(0,s.jsxs)(o.Z,{variant:"body2",color:"text.secondary",children:["شماره تلفن: ",e.phoneNumber]}),(0,s.jsxs)(o.Z,{variant:"body2",color:"text.secondary",children:["نقش: ",e.role.name]}),e.className&&(0,s.jsxs)(o.Z,{variant:"body2",color:"text.secondary",children:["کلاس: ",e.className," (",e.gradeName," - ",e.majorName,")"]})]})}),(0,s.jsxs)(d.Z,{sx:{mt:2.5},children:[(0,s.jsx)(o.Z,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"مجوزها:"}),(0,s.jsx)(d.Z,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:et(e.role.permissions)})]})]}),(0,s.jsx)(d.Z,{sx:{display:"flex",justifyContent:"flex-end",gap:1,mt:2.5},children:M[e.id]?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(g.Z,{variant:"contained",color:"primary",onClick:()=>ei(e.id),startIcon:(0,s.jsx)(S.Z,{size:18}),size:"small",sx:eu,children:"ذخیره"}),(0,s.jsx)(g.Z,{variant:"outlined",onClick:()=>er(e.id),startIcon:(0,s.jsx)(W.Z,{size:18}),size:"small",sx:{borderRadius:1.5,textTransform:"none"},children:"لغو"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(g.Z,{variant:"contained",color:"primary",onClick:()=>er(e.id),startIcon:(0,s.jsx)(_.Z,{size:18}),size:"small",sx:eu,children:"ویرایش"}),(0,s.jsx)(g.Z,{variant:"contained",color:"error",onClick:()=>eo(e.id),startIcon:(0,s.jsx)(E.Z,{size:18}),size:"small",sx:eu,children:"حذف"})]})})]})},e.id)}):(0,s.jsx)(o.Z,{align:"center",color:"text.secondary",children:"هیچ داده‌ای یافت نشد"})}),{}):(0,s.jsx)(()=>(0,s.jsx)(d.Z,{sx:{height:"calc(100vh - 180px)",overflow:"hidden"},children:(0,s.jsx)(f.Z,{component:b.Z,sx:{borderRadius:2,boxShadow:"0 2px 8px rgba(0,0,0,0.1)",height:"100%",overflow:"auto"},children:(0,s.jsxs)(y.Z,{stickyHeader:!0,"aria-label":"users table",children:[(0,s.jsx)(C.Z,{children:(0,s.jsx)(N.Z,{children:["نام کامل","کد ملی","شماره تلفن","نقش","کلاس","مجوزها","عملیات"].map(l=>(0,s.jsx)(z.Z,{sx:{backgroundColor:e.palette.primary.main,color:"white",fontWeight:"bold",minWidth:"مجوزها"===l?250:150},children:l},l))})}),(0,s.jsx)(w.Z,{children:es.length>0?es.map(e=>{var l,a,r,n,i,o;return(0,s.jsxs)(N.Z,{sx:{"&:hover":{backgroundColor:"action.hover"}},children:[(0,s.jsx)(z.Z,{children:M[e.id]?(0,s.jsx)(j.Z,{fullWidth:!0,value:null!==(l=J.fullName)&&void 0!==l?l:e.fullName,onChange:e=>en("fullName",e.target.value),size:"small"}):e.fullName}),(0,s.jsx)(z.Z,{children:M[e.id]?(0,s.jsx)(j.Z,{fullWidth:!0,value:null!==(a=J.nationalCode)&&void 0!==a?a:e.nationalCode,onChange:e=>en("nationalCode",e.target.value),size:"small"}):e.nationalCode}),(0,s.jsx)(z.Z,{children:M[e.id]?(0,s.jsx)(j.Z,{fullWidth:!0,value:null!==(r=J.phoneNumber)&&void 0!==r?r:e.phoneNumber,onChange:e=>en("phoneNumber",e.target.value),size:"small"}):e.phoneNumber}),(0,s.jsx)(z.Z,{children:M[e.id]?(0,s.jsx)(h.Z,{fullWidth:!0,value:null!==(n=J.roleId)&&void 0!==n?n:e.roleId,onChange:e=>en("roleId",Number(e.target.value)),size:"small",children:O.map(e=>(0,s.jsx)(m.Z,{value:e.id,children:e.name},e.id))}):e.role.name}),(0,s.jsx)(z.Z,{children:M[e.id]?(0,s.jsxs)(h.Z,{fullWidth:!0,value:null!==(o=null!==(i=J.classId)&&void 0!==i?i:e.classId)&&void 0!==o?o:"",onChange:e=>en("classId",""===e.target.value?"":Number(e.target.value)),size:"small",children:[(0,s.jsx)(m.Z,{value:"",children:"بدون کلاس"}),D.map(e=>(0,s.jsxs)(m.Z,{value:e.id,children:[e.name," (",e.grade," - ",e.major,")"]},e.id))]}):e.className?"".concat(e.className," (").concat(e.gradeName," - ").concat(e.majorName,")"):"-"}),(0,s.jsx)(z.Z,{children:(0,s.jsx)(d.Z,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:et(e.role.permissions)})}),(0,s.jsx)(z.Z,{children:(0,s.jsx)(d.Z,{sx:{display:"flex",gap:1},children:M[e.id]?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(g.Z,{variant:"contained",color:"primary",onClick:()=>ei(e.id),startIcon:(0,s.jsx)(S.Z,{size:18}),size:"small",sx:eu,children:"ذخیره"}),(0,s.jsx)(g.Z,{variant:"outlined",onClick:()=>er(e.id),startIcon:(0,s.jsx)(W.Z,{size:18}),size:"small",sx:{borderRadius:1.5,textTransform:"none"},children:"لغو"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(g.Z,{variant:"contained",color:"primary",onClick:()=>er(e.id),startIcon:(0,s.jsx)(_.Z,{size:18}),size:"small",sx:eu,children:"ویرایش"}),(0,s.jsx)(g.Z,{variant:"contained",color:"error",onClick:()=>eo(e.id),startIcon:(0,s.jsx)(E.Z,{size:18}),size:"small",sx:eu,children:"حذف"})]})})})]},e.id)}):(0,s.jsx)(N.Z,{children:(0,s.jsx)(z.Z,{colSpan:7,align:"center",children:(0,s.jsx)(o.Z,{color:"text.secondary",children:"هیچ داده‌ای یافت نشد"})})})})]})})}),{}),(0,s.jsx)(I.Z,{open:$.open,autoHideDuration:6e3,onClose:()=>ee({...$,open:!1}),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:(0,s.jsx)(u.Z,{onClose:()=>ee({...$,open:!1}),severity:$.severity,variant:"filled",sx:{width:"100%"},children:$.message})})]})}}},function(e){e.O(0,[6838,9311,1349,4424,1873,3457,2888,9774,179],function(){return e(e.s=88930)}),_N_E=e.O()}]);